var dragon,eof;!function(){function loopDragonData(str,data,rp){for(var _eof_data=new Eof,i=0,body="",repeat=rp||0,tk;i<=str.length;){if(tk=str[i],"<"===tk&&"?"===str[i+1]&&"="===str[i+2]){for(i+=3;;){if(tk=str[i],"?"===tk&&">"===str[i+1]){for(var pos_type=body.lastIndexOf("|"),type=-1!==pos_type?body.substr(pos_type+1).replace(/\s+/g,""):"raw",_vars=-1!==pos_type?body.substr(0,pos_type):body,token,t_pos=0,name_var="",_concat=[];;){if(token=_vars[t_pos],"undefined"==typeof token)break;if("+"===token&&(t_pos+=1,token=_vars[t_pos]),"'"===token||'"'===token){var text_concat=token;for(t_pos+=1;;){if(token=_vars[t_pos],"'"===token||"'"===token){text_concat+=token,t_pos++;break}text_concat+=token,t_pos+=1}_concat.push(text_concat)}else name_var+=token;if(/([a-zA-Z_$]+)\s+/.test(name_var)){name_var=name_var.replace(/\s+/g,"");var punctuation=name_var.indexOf(".");if(punctuation>0){var resolve='data["'+name_var.substr(0,punctuation)+'"]';_concat.push(resolve+name_var.substr(punctuation))}else _concat.push("undefined"!=typeof data[name_var]?'data["'+name_var+'"]':name_var);name_var=""}t_pos+=1}var print_value=eval(_concat.join("+"));if(!_eof_data[type])throw new Error("format type not valid");str=str.replace("<?="+body+"?>",_eof_data[type](print_value));break}body+=tk,i+=1}break}i+=1}return 0===repeat?loopDragonData(str,data,1):str}function getTemplate(e,t){var n,r;return"undefined"!=typeof window?(r=new(window.XMLHttpRequest?XMLHttpRequest:ActiveXObject)("Microsoft.XMLHTTP"),r.open("GET",e,!1),r.onload=function(){if(200!==this.status)throw new Error("error load file");n=this.response,"function"==typeof t&&t(n)},r.send()):is_node&&(n=require("fs").readFileSync(e,"utf8")),n}function evaluatorPerformSource(e,t){for(var n,r,o=new Dragon(e,t),a=0,i="",s=0;a<o.len;a++)if(n=e[a],"\n"==n&&(s+=1),"<"==n&&"?"==e[a+1]){a+=2,n=e[a];for(var c="-"===n?"dragon_comment":"!"===n?"html_comment":"",f="="===e[a]?(a++,!0):!1;;){if(n=e[a],"undefined"==typeof i||a>=o.len)throw new SyntaxError("error of syntax");if("\n"==n&&(s+=1),"?"==n&&">"==e[a+1]){var l=i;if(i="",r=r.replace(/\s+/g,""),c.length>0)return o[c](l),evaluatorPerformSource(o.source,o.data);if(f&&"yield"!=r){var u=o.lines[s],d=eof.compile(u,o.data);return evaluatorPerformSource(e.replace(u,d),o.data)}if(-1==l.indexOf(r)&&0==c.length)throw new Error("error");if(o["_"+r]){var p=o["_"+r](l.substr(r.length+1),a,s);return evaluatorPerformSource(p,o.data)}break}i+=n,/([a-zA-Z]+)\s+/.test(i)&&"undefined"==typeof r&&(r=i),a+=1}break}if("undefined"!=typeof content_extend[0]){var _=content_extend[0];return content_extend=[],evaluatorPerformSource(_+o.source,o.data)}return o}var is_node="undefined"!=typeof module&&"undefined"!=typeof module.exports;Object.assign||(Object.assign=function(e,t){for(var n in t)e[n]=t[n];return e});var ignore=["true","false","undefined","null","instanceof","typeof"],self,enumIndent,Eof,content_extend=[];enumIndent=function(e){for(var t,n=0,r=0;r<e.length;r++)if(t=e[r],!/(\s|\t)/.test(t)){n=r-1;break}return n},Eof=eof=function(){},eof.compile=function(e,t){return loopDragonData(e,t)},Eof.prototype={raw:function(e){return e.toString()},json:function(e){return JSON.stringify(e)},entity:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},e:function(e){return this.entity(e)}};var Dragon=dragon=function(e,t){this.source=e,this.data=t,this.len=this.source.length,this.lines=this.source.split(/\n/)},drBody=function(type,data,pos,line,fn){self=this;for(var t=data.replace(/(\w+)/g,function(e){return-1==ignore.indexOf(e)&&self.data[e]?'this.data["'+e+'"]':e}),n=this.lines[line],countSpace=enumIndent(n),content_indent=this.lines.slice(line+1),content_sep=this.lines.slice(0,line).join("\n")+"\n",breach=!1,inner=[],code,i=0,ob,tk,pos=0;i<content_indent.length;i++){for(ob=content_indent[i],pos=0,inner.push(ob);;){if(tk=ob[pos],"undefined"==typeof tk)break;if(!/(\s|\t)/.test(tk)){var inset=pos-1;if(countSpace===inset){var end_tag=inner.pop(),is_not_close=0==new RegExp("[<\\?]\\s*end"+type+"\\s*[\\?>]").test(end_tag),is_true=eval(t),flow=["if","elseif","else"],other_html,html;if(!/<?\s*/.test(end_tag))throw new SyntaxError("element not indented");if(code=inner.join("\n")+"\n",other_html=content_indent.slice(i+1),is_not_close&&!is_true&&(other_html=[end_tag].concat(other_html)),html=other_html.join("\n"),flow.indexOf(type)>=0)if(is_true&&is_not_close){for(var chk=0;chk<other_html.length;chk++)if(other_html[chk].match(/[<?]\s*endif\s*[?>]/)){html=other_html.slice(chk+1).join("\n");break}code=content_sep+code+html}else code=content_sep+html;else"function"==typeof fn&&(code=fn.call(this,is_true,content_sep,code,html));this.lines=code.split(/\n/),breach=!0}break}pos+=1}if(breach)break}return code};Dragon.prototype={_if:function(e,t,n){return drBody.call(this,"if",e,t,n)},_elseif:function(e,t,n){return drBody.call(this,"elseif",e,t,n)},_else:function(e,t,n){return drBody.call(this,"else","true",t,n)},_for:function(e,t,n){if(-1==e.indexOf("as"))throw"error syntax: iterator for {"+e+"}";var r=e.split("as"),o=r[0].replace(/\s+/,""),a=r[1].replace(/\s+/g,"").split(","),i=Object.assign({},this.data);return drBody.call(this,"for",o,t,n,function(e,t,n,r){var o,s,c=[];if(2===a.length?(o=a[0],s=a[1]):s=a[0],e instanceof Array){for(var f in e)o?(i[o]=f,i[s]=e[f]):i[s]=e[f],c.push(Eof.compile(n,i));return t+c.join("\n")+r}throw new Error("iterator in not object")})},_block:function(e,t,n){return drBody.call(this,"block","true",t,n,function(t,n,r,o){var a=new RegExp("(<\\?=)\\s*yield"+e.replace(/\s+/g,"\\s*")+"(\\?>)"),i=content_extend[0];return"undefined"!=typeof i&&i.match(a)&&(content_extend[0]=i.replace(a,r)),n+o})},_yield:function(e){throw new Error("the yield ["+e+"] is executed on the file dependency")},_set:function(e,t,n){function r(e){if("undefined"==typeof data[e])throw new Error("the variable ["+e+"] is not defined");return data[e]}var o=Function("return {"+e+"};").call(null,r);for(var a in o)this.data[a]=o[a];return this.source.replace(this.lines[n],"\n")},_extends:function(e,t,n){return content_extend.push(getTemplate(e.replace(/\s+/g,""))),this.source.replace(this.lines[n],"\n")},_include:function(e,t,n){return this.source.replace(this.lines[n],getTemplate(e.replace(/\s+/g,"")))},dragon_comment:function(e){this.source=this.source.replace(new RegExp("<\\?"+e+"\\?>(\\n|)"),"$1")},html_comment:function(e){this.source=this.source.replace(new RegExp("<\\?!("+e.replace("!","")+"?)\\?>"),"<!-- $1 -->")}},dragon.compile=function(e,t){try{var n=evaluatorPerformSource(e,t);return n.source.split(/\n/).join("\n")}catch(r){throw is_node||(document.body.innerHTML='<div class="stack" style="line-height:30px;font-family:monospace;padding: 10px;font-size:15px;">'+(r.stack||r).replace(/(.+[\n+|\s]?)/g,"<div>$1</div>\n")+"</div>"),r}},is_node&&(module.exports={dragon:dragon,eof:eof})}();